<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyWish - –°–æ–∑–¥–∞–π —Å–≤–æ–π –≤–∏—à–ª–∏—Å—Ç</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #7c3aed;
            --primary-dark: #6d28d9;
            --secondary: #f59e0b;
            --text: #1f2937;
            --text-light: #6b7280;
            --bg: #f8fafc;
            --white: #ffffff;
            --border: #e5e7eb;
            --success: #10b981;
            --error: #ef4444;
            --danger: #dc2626;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: var(--white);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: var(--white);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-sm {
            padding: 0.4rem 1rem;
            font-size: 0.875rem;
        }

        /* Hero */
        .hero {
            text-align: center;
            padding: 4rem 0;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: var(--white);
            border-radius: 0 0 20px 20px;
            margin-bottom: 3rem;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        /* Main Content */
        .main-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .active {
            display: block;
        }

        /* Wishlist Grid */
        .wishlist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .wish-card {
            background: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid var(--border);
            position: relative;
        }

        .wish-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .wish-card.reserved {
            border-left: 4px solid var(--success);
        }

        .wish-image {
            width: 100%;
            height: 200px;
            background: var(--bg);
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            overflow: hidden;
            position: relative;
        }

        .wish-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-placeholder {
            text-align: center;
            color: var(--text-light);
        }

        .image-placeholder i {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .wish-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .wish-price {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .wish-description {
            color: var(--text-light);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .wish-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .wish-link {
            flex: 1;
            background: var(--bg);
            color: var(--text);
            text-align: center;
            padding: 0.5rem;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .wish-link:hover {
            background: var(--border);
        }

        .reserved-badge {
            background: var(--success);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Delete buttons */
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(220, 38, 38, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .wish-card:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background: var(--danger);
            transform: scale(1.1);
        }

        /* Forms */
        .form-container {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin: 2rem 0;
            max-width: 500px;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        /* Image Upload */
        .image-upload {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-upload:hover {
            border-color: var(--primary);
        }

        .image-upload i {
            font-size: 2rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            display: none;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: var(--text-light);
            transition: all 0.2s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Share Section */
        .share-section {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
        }

        .share-link {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .share-link input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
        }

        /* Guest View */
        .guest-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: var(--white);
            padding: 2rem 0;
            text-align: center;
            border-radius: 0 0 20px 20px;
            margin-bottom: 2rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: var(--white);
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--error);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .wishlist-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-actions {
                display: none;
            }

            .delete-btn {
                opacity: 1;
                background: rgba(220, 38, 38, 0.8);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <a href="#" class="logo">
                    <i class="fas fa-gift"></i>
                    MyWish
                </a>
                <div class="nav-actions">
                    <button class="btn btn-outline" onclick="showSection('wishlists')">
                        <i class="fas fa-home"></i> –ú–æ–∏ –≤–∏—à–ª–∏—Å—Ç—ã
                    </button>
                    <button class="btn btn-primary" onclick="showSection('create')">
                        <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –≤–∏—à–ª–∏—Å—Ç
                    </button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Guest Header (hidden by default) -->
    <div id="guestHeader" class="guest-header" style="display: none;">
        <div class="container">
            <h1>üéÅ –í–∏—à–ª–∏—Å—Ç –¥—Ä—É–≥–∞</h1>
            <p>–í—ã–±–µ—Ä–∏ –ø–æ–¥–∞—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á–µ—à—å –ø–æ–¥–∞—Ä–∏—Ç—å!</p>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero" id="mainHero">
        <div class="container">
            <h1>–°–æ–∑–¥–∞–π —Å–≤–æ–π –≤–∏—à–ª–∏—Å—Ç</h1>
            <p>–î–æ–±–∞–≤–ª—è–π –∂–µ–ª–∞–µ–º—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –∏ –¥–µ–ª–∏—Å—å —Å–ø–∏—Å–∫–æ–º —Å –¥—Ä—É–∑—å—è–º–∏</p>
            <button class="btn btn-primary" onclick="showSection('create')">
                <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –≤–∏—à–ª–∏—Å—Ç
            </button>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container">
        <!-- Tabs (hidden in guest mode) -->
        <div class="tabs" id="mainTabs">
            <div class="tab active" onclick="showSection('wishlists')">–ú–æ–∏ –≤–∏—à–ª–∏—Å—Ç—ã</div>
            <div class="tab" onclick="showSection('create')">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π</div>
            <div class="tab" onclick="showSection('shared')">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</div>
        </div>

        <!-- My Wishlists Section -->
        <section id="wishlists" class="main-content active">
            <h2>–ú–æ–∏ –≤–∏—à–ª–∏—Å—Ç—ã</h2>
            <div class="wishlist-grid" id="wishlistsContainer">
                <!-- Wishlists will appear here -->
            </div>
        </section>

        <!-- Create Wishlist Section -->
        <section id="create" class="main-content">
            <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –≤–∏—à–ª–∏—Å—Ç</h2>
            <div class="form-container">
                <div class="form-group">
                    <label for="wishlistName">–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏—à–ª–∏—Å—Ç–∞</label>
                    <input type="text" id="wishlistName" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–¥–∞—Ä–∫–∏ –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è">
                </div>
                <div class="form-group">
                    <label for="wishlistDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="wishlistDescription" class="form-control" rows="3" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –æ –≤–∞—à–µ–º –≤–∏—à–ª–∏—Å—Ç–µ"></textarea>
                </div>
                <button class="btn btn-primary" onclick="createWishlist()">
                    <i class="fas fa-save"></i> –°–æ–∑–¥–∞—Ç—å –≤–∏—à–ª–∏—Å—Ç
                </button>
            </div>

            <!-- Add Item Form -->
            <div id="addItemForm" style="display: none;">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫</h3>
                <div class="form-container">
                    <div class="form-group">
                        <label for="itemName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞</label>
                        <input type="text" id="itemName" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–Ω–∏–≥–∞, –ù–∞—É—à–Ω–∏–∫–∏">
                    </div>
                    <div class="form-group">
                        <label for="itemPrice">–¶–µ–Ω–∞</label>
                        <input type="text" id="itemPrice" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1500 —Ä—É–±">
                    </div>
                    <div class="form-group">
                        <label for="itemLink">–°—Å—ã–ª–∫–∞ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω</label>
                        <input type="url" id="itemLink" class="form-control" placeholder="https://...">
                    </div>
                    <div class="form-group">
                        <label for="itemDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="itemDescription" class="form-control" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞"></textarea>
                    </div>
                    
                    <!-- Image Upload -->
                    <div class="form-group">
                        <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞</label>
                        <div class="image-upload" onclick="document.getElementById('imageInput').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</p>
                            <p style="font-size: 0.8rem; color: var(--text-light);">–ò–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</p>
                            <img id="imagePreview" class="image-preview" alt="Preview">
                        </div>
                        <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                    </div>
                    
                    <button class="btn btn-primary" onclick="addItem()">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫
                    </button>
                </div>
            </div>

            <!-- Current Wishlist Items -->
            <div id="currentWishlist" style="display: none;">
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="margin: 0;">–ü–æ–¥–∞—Ä–∫–∏ –≤ –≤–∏—à–ª–∏—Å—Ç–µ "<span id="currentWishlistTitle"></span>"</h3>
                    <button class="btn btn-danger btn-sm" onclick="deleteCurrentWishlist()">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤–∏—à–ª–∏—Å—Ç
                    </button>
                </div>
                <div class="wishlist-grid" id="currentWishlistItems">
                    <!-- Items will appear here -->
                </div>
            </div>
        </section>

        <!-- Share Section -->
        <section id="shared" class="main-content">
            <h2>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤–∏—à–ª–∏—Å—Ç–æ–º</h2>
            <div class="share-section">
                <i class="fas fa-share-alt" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                <h3>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–∑—å—è–º–∏</h3>
                <p>–í–∞—à–∏ –¥—Ä—É–∑—å—è —Å–º–æ–≥—É—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞—à –≤–∏—à–ª–∏—Å—Ç –∏ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∞—Ä–∫–∏</p>
                
                <div class="share-link">
                    <input type="text" id="shareUrl" readonly>
                    <button class="btn btn-primary" onclick="copyShareLink()">
                        <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
                
                <div style="margin-top: 2rem;">
                    <h4>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–ª—è –¥—Ä—É–∑–µ–π:</h4>
                    <button class="btn btn-outline" onclick="previewGuestView()">
                        <i class="fas fa-eye"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫ –¥—Ä—É–≥
                    </button>
                </div>
            </div>
        </section>

        <!-- Guest View Section -->
        <section id="guestView" class="main-content">
            <h2>–í–∏—à–ª–∏—Å—Ç: <span id="guestWishlistTitle"></span></h2>
            <p id="guestWishlistDescription" style="color: var(--text-light); margin-bottom: 2rem;"></p>
            
            <div class="wishlist-grid" id="guestWishlistItems">
                <!-- Guest items will appear here -->
            </div>
        </section>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Data storage
        let wishlists = JSON.parse(localStorage.getItem('wishlists')) || [];
        let currentWishlist = null;
        let currentImageData = null;

        // Check if we're in guest mode from URL
        function checkGuestMode() {
            const urlParams = new URLSearchParams(window.location.search);
            const wishlistId = urlParams.get('wishlist');
            
            if (wishlistId) {
                enableGuestMode(parseInt(wishlistId));
            } else {
                enableCreatorMode();
            }
        }

        // Enable guest mode
        function enableGuestMode(wishlistId) {
            document.getElementById('mainHero').style.display = 'none';
            document.getElementById('mainTabs').style.display = 'none';
            document.getElementById('guestHeader').style.display = 'block';
            document.querySelector('.header').style.display = 'none';
            
            const wishlist = wishlists.find(w => w.id === wishlistId);
            if (wishlist) {
                document.getElementById('guestWishlistTitle').textContent = wishlist.name;
                document.getElementById('guestWishlistDescription').textContent = wishlist.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
                renderGuestWishlist(wishlist);
                showSection('guestView');
            } else {
                document.getElementById('guestWishlistTitle').textContent = '–í–∏—à–ª–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω';
                showNotification('–í–∏—à–ª–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            }
        }

        // Enable creator mode
        function enableCreatorMode() {
            document.getElementById('mainHero').style.display = 'block';
            document.getElementById('mainTabs').style.display = 'flex';
            document.getElementById('guestHeader').style.display = 'none';
            document.querySelector('.header').style.display = 'block';
            showSection('wishlists');
            renderWishlists();
        }

        // Show/hide sections
        function showSection(sectionId) {
            document.querySelectorAll('.main-content').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.textContent.includes(
                    sectionId === 'wishlists' ? '–ú–æ–∏ –≤–∏—à–ª–∏—Å—Ç—ã' :
                    sectionId === 'create' ? '–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π' :
                    '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è'
                )) {
                    tab.classList.add('active');
                }
            });

            if (sectionId === 'wishlists') {
                renderWishlists();
            } else if (sectionId === 'shared') {
                updateShareLink();
            }
        }

        // Handle image upload
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentImageData = e.target.result;
                    const preview = document.getElementById('imagePreview');
                    preview.src = currentImageData;
                    preview.style.display = 'block';
                    document.querySelector('.image-upload i').style.display = 'none';
                    document.querySelector('.image-upload p').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        // Create new wishlist
        function createWishlist() {
            const name = document.getElementById('wishlistName').value.trim();
            const description = document.getElementById('wishlistDescription').value.trim();
            
            if (!name) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∏—à–ª–∏—Å—Ç–∞', 'error');
                return;
            }
            
            const newWishlist = {
                id: Date.now(),
                name: name,
                description: description,
                items: [],
                createdAt: new Date().toISOString()
            };
            
            wishlists.push(newWishlist);
            saveWishlists();
            
            document.getElementById('wishlistName').value = '';
            document.getElementById('wishlistDescription').value = '';
            
            currentWishlist = newWishlist;
            document.getElementById('addItemForm').style.display = 'block';
            document.getElementById('currentWishlist').style.display = 'block';
            document.getElementById('currentWishlistTitle').textContent = name;
            
            showNotification('–í–∏—à–ª–∏—Å—Ç —Å–æ–∑–¥–∞–Ω! –¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–∞—Ä–∫–∏ üéÅ', 'success');
        }

        // Add item to current wishlist
        function addItem() {
            if (!currentWishlist) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –≤–∏—à–ª–∏—Å—Ç', 'error');
                return;
            }
            
            const name = document.getElementById('itemName').value.trim();
            const price = document.getElementById('itemPrice').value.trim();
            const link = document.getElementById('itemLink').value.trim();
            const description = document.getElementById('itemDescription').value.trim();
            
            if (!name) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞', 'error');
                return;
            }
            
            const newItem = {
                id: Date.now(),
                name: name,
                price: price || '–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞',
                link: link || '#',
                description: description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç',
                reserved: false,
                image: currentImageData || 'https://via.placeholder.com/300x200?text=–ü–æ–¥–∞—Ä–æ–∫'
            };
            
            currentWishlist.items.push(newItem);
            saveWishlists();
            
            // Clear form
            document.getElementById('itemName').value = '';
            document.getElementById('itemPrice').value = '';
            document.getElementById('itemLink').value = '';
            document.getElementById('itemDescription').value = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('imagePreview').src = '';
            document.querySelector('.image-upload i').style.display = 'block';
            document.querySelector('.image-upload p').style.display = 'block';
            currentImageData = null;
            document.getElementById('imageInput').value = '';
            
            renderCurrentWishlistItems();
            showNotification('–ü–æ–¥–∞—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω! üéâ', 'success');
        }

        // Delete current wishlist
        function deleteCurrentWishlist() {
            if (!currentWishlist) return;
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –≤–∏—à–ª–∏—Å—Ç "${currentWishlist.name}" –∏ –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏ –≤ –Ω–µ–º?`)) {
                wishlists = wishlists.filter(w => w.id !== currentWishlist.id);
                saveWishlists();
                
                document.getElementById('addItemForm').style.display = 'none';
                document.getElementById('currentWishlist').style.display = 'none';
                currentWishlist = null;
                
                showSection('wishlists');
                showNotification('–í–∏—à–ª–∏—Å—Ç —É–¥–∞–ª–µ–Ω', 'success');
            }
        }

        // Delete wishlist from main view
        function deleteWishlist(wishlistId) {
            const wishlist = wishlists.find(w => w.id === wishlistId);
            if (!wishlist) return;
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –≤–∏—à–ª–∏—Å—Ç "${wishlist.name}" –∏ –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏ –≤ –Ω–µ–º?`)) {
                wishlists = wishlists.filter(w => w.id !== wishlistId);
                saveWishlists();
                
                if (currentWishlist && currentWishlist.id === wishlistId) {
                    document.getElementById('addItemForm').style.display = 'none';
                    document.getElementById('currentWishlist').style.display = 'none';
                    currentWishlist = null;
                }
                
                renderWishlists();
                showNotification('–í–∏—à–ª–∏—Å—Ç —É–¥–∞–ª–µ–Ω', 'success');
            }
        }

        // Delete item from wishlist
        function deleteItem(itemId) {
            if (!currentWishlist) return;
            
            const item = currentWishlist.items.find(i => i.id === itemId);
            if (!item) return;
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫ "${item.name}"?`)) {
                currentWishlist.items = currentWishlist.items.filter(i => i.id !== itemId);
                saveWishlists();
                renderCurrentWishlistItems();
                showNotification('–ü–æ–¥–∞—Ä–æ–∫ —É–¥–∞–ª–µ–Ω', 'success');
            }
        }

        // Reserve item (guest function)
        function reserveItem(itemId) {
            if (!currentWishlist) return;
            
            const item = currentWishlist.items.find(i => i.id === itemId);
            if (item && !item.reserved) {
                if (confirm(`–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å "${item.name}"? –î—Ä—É–≥–∏–µ —É–≤–∏–¥—è—Ç, —á—Ç–æ –ø–æ–¥–∞—Ä–æ–∫ —É–∂–µ –∑–∞–Ω—è—Ç!`)) {
                    item.reserved = true;
                    saveWishlists();
                    renderGuestWishlist(currentWishlist);
                    showNotification(`–í—ã –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª–∏: ${item.name} üéÅ`, 'success');
                }
            }
        }

        // Unreserve item
        function unreserveItem(itemId) {
            if (!currentWishlist) return;
            
            const item = currentWishlist.items.find(i => i.id === itemId);
            if (item) {
                item.reserved = false;
                saveWishlists();
                renderCurrentWishlistItems();
                showNotification('–ë—Ä–æ–Ω—å –æ—Ç–º–µ–Ω–µ–Ω–∞', 'success');
            }
        }

        // Render wishlists
        function renderWishlists() {
            const container = document.getElementById('wishlistsContainer');
            
            if (wishlists.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-gift"></i>
                        <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –≤–∏—à–ª–∏—Å—Ç–æ–≤</h3>
                        <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –≤–∏—à–ª–∏—Å—Ç –∏ –¥–æ–±–∞–≤—å—Ç–µ –∂–µ–ª–∞–µ–º—ã–µ –ø–æ–¥–∞—Ä–∫–∏</p>
                        <button class="btn btn-primary" onclick="showSection('create')">
                            –°–æ–∑–¥–∞—Ç—å –≤–∏—à–ª–∏—Å—Ç
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = wishlists.map(wishlist => `
                <div class="wish-card" onclick="openWishlist(${wishlist.id})">
                    <button class="delete-btn" onclick="event.stopPropagation(); deleteWishlist(${wishlist.id})" title="–£–¥–∞–ª–∏—Ç—å –≤–∏—à–ª–∏—Å—Ç">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="wish-image">
                        ${wishlist.items.length > 0 && wishlist.items[0].image ? 
                            `<img src="${wishlist.items[0].image}" alt="${wishlist.name}">` :
                            `<div class="image-placeholder">
                                <i class="fas fa-gift"></i>
                                <p>–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</p>
                            </div>`
                        }
                    </div>
                    <div class="wish-title">${wishlist.name}</div>
                    <div class="wish-description">${wishlist.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</div>
                    <div style="color: var(--text-light); font-size: 0.9rem;">
                        ${wishlist.items.length} –ø–æ–¥–∞—Ä–∫–æ–≤ ‚Ä¢ 
                        ${wishlist.items.filter(item => item.reserved).length} –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ
                    </div>
                </div>
            `).join('');
        }

        // Render current wishlist items
        function renderCurrentWishlistItems() {
            if (!currentWishlist) return;
            
            const container = document.getElementById('currentWishlistItems');
            container.innerHTML = currentWishlist.items.map(item => `
                <div class="wish-card ${item.reserved ? 'reserved' : ''}">
                    <button class="delete-btn" onclick="deleteItem(${item.id})" title="–£–¥–∞–ª–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="wish-image">
                        <img src="${item.image}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/300x200?text=–û—à–∏–±–∫–∞+–∑–∞–≥—Ä—É–∑–∫–∏'">
                    </div>
                    <div class="wish-title">${item.name}</div>
                    <div class="wish-price">${item.price}</div>
                    <div class="wish-description">${item.description}</div>
                    ${item.reserved ? '<div class="reserved-badge">‚úÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ</div>' : ''}
                    <div class="wish-actions">
                        ${item.link !== '#' ? `<a href="${item.link}" target="_blank" class="wish-link">üõí –ö—É–ø–∏—Ç—å</a>` : ''}
                        ${item.reserved ? 
                            `<button class="btn btn-outline" onclick="unreserveItem(${item.id})" style="flex: 1;">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å</button>` :
                            `<button class="btn" disabled style="flex: 1; background: var(--bg);">üÜì –°–≤–æ–±–æ–¥–Ω–æ</button>`
                        }
                    </div>
                </div>
            `).join('');
        }

        // Render guest wishlist
        function renderGuestWishlist(wishlist) {
            const container = document.getElementById('guestWishlistItems');
            currentWishlist = wishlist;
            
            if (!wishlist.items || wishlist.items.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-gift"></i>
                        <h3>–í —ç—Ç–æ–º –≤–∏—à–ª–∏—Å—Ç–µ –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤</h3>
                        <p>–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –¥—Ä—É–≥–∞ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–∫–∏ –≤ —Å–ø–∏—Å–æ–∫</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = wishlist.items.map(item => `
                <div class="wish-card ${item.reserved ? 'reserved' : ''}">
                    <div class="wish-image">
                        <img src="${item.image}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/300x200?text=–û—à–∏–±–∫–∞+–∑–∞–≥—Ä—É–∑–∫–∏'">
                    </div>
                    <div class="wish-title">${item.name}</div>
                    <div class="wish-price">${item.price}</div>
                    <div class="wish-description">${item.description}</div>
                    ${item.reserved ? 
                        '<div class="reserved-badge">üéÅ –£–∂–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω</div>' :
                        `<button class="btn btn-success" onclick="reserveItem(${item.id})" style="width: 100%;">
                            <i class="fas fa-gift"></i> –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –ø–æ–¥–∞—Ä–æ–∫
                        </button>`
                    }
                    ${item.link !== '#' ? `<a href="${item.link}" target="_blank" class="wish-link" style="width: 100%; text-align: center; margin-top: 0.5rem;">üõí –°—Å—ã–ª–∫–∞ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω</a>` : ''}
                </div>
            `).join('');
        }

        // Open wishlist
        function openWishlist(id) {
            currentWishlist = wishlists.find(w => w.id === id);
            document.getElementById('addItemForm').style.display = 'block';
            document.getElementById('currentWishlist').style.display = 'block';
            document.getElementById('currentWishlistTitle').textContent = currentWishlist.name;
            renderCurrentWishlistItems();
            showSection('create');
        }

        // Update share link
        function updateShareLink() {
            if (currentWishlist) {
                const shareUrl = `${window.location.origin}${window.location.pathname}?wishlist=${currentWishlist.id}`;
                document.getElementById('shareUrl').value = shareUrl;
            } else if (wishlists.length > 0) {
                const shareUrl = `${window.location.origin}${window.location.pathname}?wishlist=${wishlists[0].id}`;
                document.getElementById('shareUrl').value = shareUrl;
            } else {
                document.getElementById('shareUrl').value = '–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –≤–∏—à–ª–∏—Å—Ç';
            }
        }

        // Copy share link
        function copyShareLink() {
            const shareInput = document.getElementById('shareUrl');
            if (shareInput.value !== '–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –≤–∏—à–ª–∏—Å—Ç') {
                shareInput.select();
                document.execCommand('copy');
                showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –¥—Ä—É–∑—å—è–º üìß', 'success');
            }
        }

        // Preview guest view
        function previewGuestView() {
            if (currentWishlist) {
                const shareUrl = `${window.location.origin}${window.location.pathname}?wishlist=${currentWishlist.id}`;
                window.open(shareUrl, '_blank');
            } else {
                showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –≤–∏—à–ª–∏—Å—Ç', 'error');
            }
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Save to localStorage
        function saveWishlists() {
            localStorage.setItem('wishlists', JSON.stringify(wishlists));
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Enable drag and drop for image upload
            const imageUpload = document.querySelector('.image-upload');
            imageUpload.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--primary)';
                this.style.background = 'var(--bg)';
            });
            
            imageUpload.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--border)';
                this.style.background = 'transparent';
            });
            
            imageUpload.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--border)';
                this.style.background = 'transparent';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    document.getElementById('imageInput').files = files;
                    handleImageUpload({ target: { files: files } });
                }
            });
            
            checkGuestMode();
        });
    </script>
</body>
</html>
